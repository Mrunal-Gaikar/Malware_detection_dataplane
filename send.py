#!/usr/bin/env python3
import argparse
import sys
import socket
import random
import struct
from scapy.all import *
from scapy.all import sendp, send, get_if_list, get_if_hwaddr
from scapy.all import Packet
from scapy.all import Ether, IP, UDP, TCP
import random



def get_if():
    ifs=get_if_list()
    iface=None
    for i in get_if_list():
        if "eth0" in i:
            iface=i
            break
    if not iface:
        print("Cannot find eth0 interface")
        exit(1)
    return iface

def main():
    

    if len(sys.argv)<2:
        print('pass 1 arguments: <destination>')
        exit(1)

    addr = socket.gethostbyname(sys.argv[1])
    iface = get_if()
    i=1
    print("sending on interface %s to %s" % (iface, str(addr)))
    while(i<=50):
        flags1=["SA","S"]  #malicious
        length1=[65,139,65,143,136,20]
        num3 = random.randint(0,1)
        num4 = random.randint(0,5)
        

        pkt =  Ether(src=get_if_hwaddr(iface),dst = "00:00:00:00:00:00")
        pkt = pkt /IP(dst=addr, tos=1)/TCP(sport=2222,dport=255,flags="PA")/Raw(str(RandString(size=length1[num4]-1))+"1")
        pkt.show2()
        sendp(pkt, iface=iface, verbose=False)
        pkt1 =  Ether(src=get_if_hwaddr(iface),dst = "00:00:00:00:00:00")
        pkt1 = pkt1 /IP(dst=addr, tos=1)/TCP(sport=2222,dport=255,flags=flags1[num3])/Raw(str(RandString(size=3))+"1")
        pkt1.show2()      
 
        sendp(pkt1, iface=iface, verbose=False)
        flags = ["A","U","R","P","PU"] #non malicious
        flags2=["PA","SA"]
        len2=[260,8]
        lengths = [34,26,34,25,440,500]
        len1=[260,140,24,10,480,440,510,490]
        num1 = random.randint(0,4)
        num2 = random.randint(0,7)
        num5 = random.randint(0,5)
        
        pkt2 =  Ether(src=get_if_hwaddr(iface),dst = "00:00:00:00:00:00")
        pkt2 = pkt2 /IP(dst=addr, tos=1)/TCP(sport=2222,dport=255,flags=flags[num1])/Raw(str(RandString(size=lengths[num5]-1))+"0")
        pkt2.show2()
        sendp(pkt2, iface=iface, verbose=False)

        pkt3 =  Ether(src=get_if_hwaddr(iface),dst = "00:00:00:00:00:00")
        pkt3 = pkt3 /IP(dst=addr, tos=1)/TCP(sport=2222,dport=255,flags="PA")/Raw(str(RandString(size=len1[num2]-1))+"0")
        pkt3.show2()
        sendp(pkt3, iface=iface, verbose=False)
        """
        pkt4 =  Ether(src=get_if_hwaddr(iface),dst = "00:00:00:00:00:00")
        pkt4 = pkt4 /IP(dst=addr, tos=1)/TCP(sport=2222,dport=255,flags=flags2[num3])/Raw(str(RandString(size=len2[num3]-1))+"0")
        pkt4.show2()
        sendp(pkt4, iface=iface, verbose=False)
        """
    
    
        i=i+1


if __name__ == '__main__':
    main()






